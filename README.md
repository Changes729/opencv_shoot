> 此版本有诸多接口与硬件强绑定，考虑未来进行更新

# 听JIAN 射击点定位

**听JIAN** 基于红外平面定位方案对红外激光模拟的弓箭射击点进行判断。

全系统包括三大块内容：

- 应用层：Unity 音视频交互前端
- 感知层：OpenCV 图像处理感知 & ESP 弓箭状态同步
- 物理层：ESP 弓箭交互式装置 & 红外识别摄像头



## 系统环境

**01 网络环境**

弓箭内核是ESP，采用TCP/IP协议栈与主机进行通信。由于当前版本固件写死，WiFi 网络环境也是固定内容：

- SSID：tingjian
- Passwd：13818611371
- DHCP Server：192.168.199.0
- Mask：255.255.255.0
- Gate way：192.168.199.1



**02 电脑环境（Python）**

由于弓箭需要同PC进行数据同步，因此，PC的某些网络环境是固定死的：

- 主机IP：192.168.199.167
- HTTP 端口：5000

> 像我 Mac 端就会出现 5000 被占用的情况，然后这个系统对我来说就几乎不可跑



## 应用接口

应用接口通过HTTP访问。

由于硬件设计原因，部分网络接口和硬件绑定。详细代码可以看 server.py 

- `GET /aim_info` ：获取射击目标点的数据

  ```json
  {"totalIndex": 1, "infos": [{"index": 0, "position": [0.51, 0.49], "camera": 0}]}
  ```

- `GET /shoot`：（ESP used）弓箭用来同步自身的发射状态

- `GET /shoot_info`：获取各个弓箭射击的情况

  ```json
  {"shoot": [True, False]}
  ```



## 功能实现

**01 射击点定位**

射击点定位是通过红外识别定位的。

一般来说，一个摄像头的分辨率会映射到我们的交互区域。但是考虑到摄像头畸变，所以需要在开始进行矫正。



**02 矩形矫正**

矩形矫正基本上是需要在暗环境中找到四角定位锚点。最简单的算法就是二值化 + 图形矫正。



**03 射击行为识别**

根据硬件开发者表述，硬件设计行为是通过滑动变阻器阻值变化监测实现的。在多人模式下，判断设计者主要是根据IP确定的。



## 使用方法

主程序是位于目录下的 `tingjian.py`。

**00 环境配置**

- 首先需要安装pip（一般安装Python就会自带的）
- 构建虚拟环境（推荐）：`python -m venv venv`
- 通过pip安装python依赖：`pip -r requirements.txt`



**01 定位点初始化**

`python ./tingjian.py --init`



**02 系统运行**

`python ./tingjian.py`